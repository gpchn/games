<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>æ·±ç©ºé˜²çº¿ - ç»ˆæå¹³è¡¡ç‰ˆ</title><link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet"><style>:root{--bg:#0a0e17;--accent:#00f2ff;--danger:#ff3366;--gold:#ffd700;--green:#00ff88;--purple:#bf00ff}*{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent}body{font-family:'Noto Sans SC',sans-serif;background:#000;color:#fff;overflow:hidden;height:100vh;width:100vw}#app{width:100%;height:100%;position:relative;display:flex;flex-direction:column}canvas{display:block;position:absolute;top:0;left:0;z-index:1;background-color:var(--bg)}.ui-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none;display:flex;flex-direction:column}.header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:linear-gradient(to bottom,rgba(0,0,0,.8),transparent);pointer-events:auto}.stat{font-family:Orbitron,monospace;font-weight:700;font-size:14px;display:flex;align-items:center;gap:5px;text-shadow:0 0 5px currentColor}.pause-btn{background:rgba(0,0,0,.5);border:1px solid var(--accent);color:var(--accent);padding:5px 10px;border-radius:4px;cursor:pointer;font-family:Orbitron;font-size:12px;display:flex;align-items:center;gap:5px}.footer{margin-top:auto;height:100px;background:rgba(10,15,25,.95);border-top:1px solid rgba(0,242,255,.2);pointer-events:auto;padding:10px;display:flex;flex-direction:column}.shop-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:4px;flex:1}.card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;position:relative;padding:2px}.card.selected{border-color:var(--accent);background:rgba(0,242,255,.1);box-shadow:0 0 10px rgba(0,242,255,.2)}.card.locked{opacity:.3;pointer-events:none}.card-icon{font-size:18px;line-height:1}.card-name{font-size:8px;color:#888;margin-top:1px}.card-cost{position:absolute;top:1px;right:2px;font-size:8px;color:var(--gold);font-family:Orbitron}.modal-bg{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:100;pointer-events:auto}.modal{background:#151c28;border:1px solid var(--accent);padding:20px;border-radius:8px;text-align:center;min-width:240px;box-shadow:0 0 30px rgba(0,0,0,.5);max-height:80vh;overflow-y:auto}.btn{background:0 0;border:1px solid var(--accent);color:var(--accent);padding:8px 20px;margin:5px;cursor:pointer;font-family:Orbitron;font-size:12px;transition:all .2s}.btn:hover{background:rgba(0,242,255,.2)}.btn-danger{border-color:var(--danger);color:var(--danger)}.btn-success{border-color:var(--green);color:var(--green)}.btn-warning{border-color:var(--gold);color:var(--gold)}.toast{position:absolute;top:20%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.8);color:var(--accent);padding:10px 20px;border-radius:4px;font-family:Orbitron;opacity:0;transition:opacity .3s;pointer-events:none;border:1px solid var(--accent);z-index:200}#pauseOverlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:50;display:none;flex-direction:column;align-items:center;justify-content:center;pointer-events:auto;color:var(--accent);font-family:Orbitron}.pause-content{display:flex;flex-direction:column;gap:15px;align-items:center;width:80%;max-width:300px}.btn-large{width:100%;padding:12px;font-size:14px;border-width:2px}.btn-small{width:80%;padding:8px;font-size:11px;opacity:.8}.info-grid{display:grid;grid-template-columns:auto 1fr;gap:2px 10px;text-align:left;margin-top:5px;font-size:12px}.info-key{color:#888}.info-val{color:#fff;font-family:Orbitron,monospace}#screen-start{position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,#1a2a3a 0,#000 100%);z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden}.star{position:absolute;background:#fff;border-radius:50%;animation:twinkle linear infinite;opacity:0;will-change:transform,opacity}@keyframes twinkle{0%{transform:translateY(100vh) scale(.5);opacity:0}50%{opacity:.8}100%{transform:translateY(-10vh) scale(1.2);opacity:0}}.menu-content{z-index:10;text-align:center;width:80%;max-width:400px}.menu-title{font-family:Orbitron;font-size:36px;color:var(--accent);text-shadow:0 0 20px var(--accent);margin-bottom:10px;animation:glow 2s ease-in-out infinite alternate}.menu-subtitle{color:#555;margin-bottom:40px;font-size:14px}.menu-btn-group{display:flex;flex-direction:column;gap:15px}.menu-btn{width:100%;padding:15px;font-size:16px;border-width:2px}@keyframes glow{from{text-shadow:0 0 10px var(--accent)}to{text-shadow:0 0 25px var(--accent),0 0 10px #fff}}#screen-levels{z-index:250}#screen-codex{z-index:260}.codex-content{text-align:left;width:90vw;max-width:500px}.codex-tabs{display:flex;margin-bottom:15px;border-bottom:1px solid var(--accent)}.codex-tab{flex:1;padding:10px;cursor:pointer;background:0 0;border:none;color:#555;font-family:Orbitron;transition:all .2s}.codex-tab.active{color:var(--accent);border-bottom:2px solid var(--accent)}.codex-list{display:flex;flex-direction:column;gap:10px;max-height:50vh;overflow-y:auto;padding-right:5px}.codex-item{background:rgba(255,255,255,.05);padding:10px;border-radius:6px;display:flex;align-items:center;gap:10px}.codex-icon{font-size:24px;width:40px;text-align:center;flex-shrink:0}.codex-info{flex-grow:1}.codex-info h3{margin:0 0 5px 0;color:var(--accent);font-size:14px}.codex-info p{margin:0;font-size:11px;color:#aaa;line-height:1.4}.codex-stats{font-size:10px;color:var(--gold);margin-top:2px;display:grid;grid-template-columns:1fr 1fr;gap:2px}</style></head><body><div id="app"><canvas id="gameCanvas"></canvas><div class="ui-layer"><div class="header"><div class="stat" style="color:var(--gold)">ğŸ’° <span id="s-gold">300</span></div><div class="stat" style="color:var(--accent)">WAVE <span id="s-wave">0</span></div><div class="stat" style="color:var(--danger)">â¤ï¸ <span id="s-hp">20</span>/<span id="s-maxhp">20</span></div><button class="pause-btn" onclick="Game.togglePause()">â¸ï¸ <span id="pause-text">æš‚åœ</span></button></div><div id="toast" class="toast"></div><div class="footer"><div class="shop-grid" id="shop"></div></div></div><div id="pauseOverlay"><h1>PAUSED</h1><p style="color:#888;margin-bottom:20px">æ¸¸æˆå·²æš‚åœ</p><div class="pause-content"><button class="btn btn-large" onclick="Game.togglePause()">ç»§ç»­æ¸¸æˆ</button> <button class="btn btn-small btn-warning" onclick="Game.returnToMenu()">å›åˆ°ä¸»èœå•</button></div></div><div id="ctxMenu" class="modal-bg"><div class="modal"><h2 id="ctx-title">ç‚®å¡”</h2><div style="min-height:60px;margin-bottom:10px" id="ctx-info"></div><button class="btn btn-success" onclick="Game.upgrade()">å‡çº§ ($<span id="ctx-cost">0</span>)</button> <button class="btn btn-danger" onclick="Game.sell()">å‡ºå”® (+$<span id="ctx-sell">0</span>)</button> <button class="btn" onclick="Game.closeMenu()">å…³é—­</button></div></div><div id="screen-start"><div id="star-container"></div><div class="menu-content"><h1 class="menu-title">DEEP SPACE</h1><p class="menu-subtitle">ç»ˆæå¹³è¡¡ç‰ˆ v9.5</p><div class="menu-btn-group"><button class="btn menu-btn" onclick="Game.start()">å¼€å§‹æ¸¸æˆ</button> <button class="btn menu-btn" onclick="UI.showLevels()">é€‰å…³</button> <button class="btn menu-btn" onclick="UI.showCodex()">ğŸ“– å›¾é‰´</button></div></div></div><div id="screen-levels" class="modal-bg"><div class="modal"><h2 style="color:var(--accent)">é€‰æ‹©å…³å¡</h2><p style="color:#888;font-size:12px;margin:10px 0">åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p><div style="min-height:150px;display:flex;align-items:center;justify-content:center;color:#555">æš‚æ— å†…å®¹</div><button class="btn" style="margin-top:10px" onclick="UI.hideLevels()">è¿”å›</button></div></div><div id="screen-codex" class="modal-bg"><div class="modal codex-content"><div class="codex-tabs"><button class="codex-tab active" onclick='UI.switchCodexTab("turret")'>ç‚®å¡”</button> <button class="codex-tab" onclick='UI.switchCodexTab("enemy")'>æ•Œäºº</button></div><div id="codex-list" class="codex-list"></div><button class="btn" style="margin-top:15px;width:100%" onclick="UI.hideCodex()">è¿”å›</button></div></div><div id="screen-over" class="modal-bg" style="display:none"><div class="modal"><h1 style="color:var(--danger)">GAME OVER</h1><p style="margin:10px 0">é˜²çº¿å´©æºƒ</p><p>æœ€é«˜æ³¢æ¬¡: <span id="final-score" style="color:var(--accent)">0</span></p><button class="btn" style="margin-top:10px" onclick="Game.restart()">é‡æ–°å¼€å§‹</button></div></div></div><script>const CFG={COLS:7,ROWS:8,INIT_GOLD:300,INIT_HP:20};function hexToRgb(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:255,g:255,b:255}}function darkenColor(t,e){const s=hexToRgb(t);return`rgb(${Math.floor(s.r*e)}, ${Math.floor(s.g*e)}, ${Math.floor(s.b*e)})`}const T_DEFS=[{id:"wall",name:"å¢™",cost:25,hp:2e3,dmg:0,range:0,cd:0,emoji:"ğŸ§±",color:"#555",isWall:!0,desc:"åšå®çš„å±éšœã€‚å¡«æ»¡æ•´ä¸ªæ ¼å­ï¼Œé˜»æŒ¡æ•Œäººå‰è¿›ã€‚",upg:{hp:1200}},{id:"gun",name:"æœºæª",cost:50,hp:200,dmg:15,range:150,cd:15,emoji:"ğŸ”«",color:"#00f2ff",desc:"åŸºç¡€è¾“å‡ºå•å…ƒã€‚å°„é€Ÿå¿«ï¼Œä¼¤å®³é€‚ä¸­ã€‚",upg:{dmg:2,cd:-1,range:5,hp:20}},{id:"sniper",name:"ç‹™å‡»",cost:100,hp:100,dmg:150,range:250,cd:70,emoji:"ğŸ¯",color:"#ff3366",desc:"è¿œç¨‹é«˜ä¼¤å®³ã€‚é€‚åˆæ‰“å‡»é«˜è¡€é‡ç›®æ ‡ã€‚",upg:{dmg:30,range:5,hp:10}},{id:"frost",name:"å†°å†»",cost:75,hp:150,dmg:5,range:150,cd:20,emoji:"â„ï¸",color:"#66ccff",effect:"freeze",effectVal:50,desc:"æ§åˆ¶å‹ç‚®å¡”ã€‚å†»ç»“æ•Œäººã€‚å¯¹Bossæ•ˆæœå‡å¼±ã€‚",upg:{effectVal:8,range:5,hp:15}},{id:"laser",name:"æ¿€å…‰",cost:200,hp:180,dmg:1,range:220,cd:0,emoji:"âš¡",color:"#bf00ff",isLaser:!0,desc:"æŒç»­ä¼¤å®³å…‰æŸã€‚åŒæ—¶æ”»å‡»å°„ç¨‹å†…æ‰€æœ‰æ•Œäººã€‚",upg:{dmg:.2,range:8,hp:20}},{id:"support",name:"ä¿®å¤",cost:180,hp:50,heal:.02,range:150,cd:60,emoji:"ğŸ› ï¸",color:"#00ff88",isSupport:!0,desc:"è¾…åŠ©ç‚®å¡”ã€‚ä¿®å¤å‹æ–¹ç‚®å¡”ã€‚æ‹¦æˆªBossæ¿€å…‰ã€‚",upg:{heal:.008,cd:-5,range:5}},{id:"emp",name:"ç”µç£",cost:180,hp:120,dmg:10,range:180,cd:90,emoji:"â˜¢ï¸",color:"#ffff00",effect:"repel",effectVal:60,desc:"å°†æ•Œäººå¿«é€Ÿç§»å›ç¬¬ä¸€æ’å¹¶é€ æˆè·¯å¾„ä¼¤å®³ã€‚å¯¹Bossæ— æ•ˆã€‚",upg:{effectVal:10,dmg:5,hp:15}},{id:"bomb",name:"ç‚¸å¼¹",cost:100,hp:1,dmg:99999,range:1.5,cd:0,emoji:"ğŸ’£",color:"#ff8800",isBomb:!0,desc:"ç«‹å³ç§’æ€9x9èŒƒå›´å†…æ‰€æœ‰æ•Œäººã€‚",upg:{}}],E_DEFS={ghost:{name:"å¹½çµ",emoji:"ğŸ‘»",hp:60,spd:1.5,dmg:30,val:15,color:"#aaf",range:0,desc:"ç§»åŠ¨é€Ÿåº¦å¿«ï¼Œä½†è¡€é‡ä½ã€‚"},zombie:{name:"åƒµå°¸",emoji:"ğŸ§Ÿ",hp:250,spd:.8,dmg:60,val:25,color:"#5f5",range:0,desc:"ç§»åŠ¨ç¼“æ…¢ï¼Œè¡€é‡è¾ƒé«˜ã€‚"},skull:{name:"éª·é«…",emoji:"ğŸ’€",hp:100,spd:2.5,dmg:20,val:20,color:"#fff",range:0,desc:"é€Ÿåº¦æå¿«ã€‚"},tank:{name:"å¦å…‹",emoji:"ğŸ¤–",hp:600,spd:.5,dmg:80,val:50,color:"#888",range:0,desc:"è¡€é‡æåšã€‚"},ranger:{name:"ç‹™å‡»æ‰‹",emoji:"ğŸ¹",hp:150,spd:1,dmg:100,val:40,color:"#ff9933",range:200,desc:"ç§»åŠ¨åˆ°ç¬¬ä¸€æ’ååœä¸‹å¹¶è¿œç¨‹æ”»å‡»ã€‚"},splitter:{name:"åˆ†è£‚ä½“",emoji:"ğŸ¦ ",hp:120,spd:1.2,dmg:10,val:10,color:"#32CD32",range:0,desc:"æ­»äº¡æ—¶åˆ†è£‚ã€‚"},healer:{name:"æ²»ç–—å¸ˆ",emoji:"ğŸ§™",hp:200,spd:.9,dmg:10,val:60,color:"#FF69B4",range:120,desc:"æ²»ç–—å‘¨å›´æ•Œäººã€‚"},demon:{name:"æ¶é­”",emoji:"ğŸ‘¹",hp:4e3,spd:.4,dmg:250,val:300,color:"#ff0000",range:50,desc:"ç²¾è‹±å•ä½ã€‚"},boss:{name:"Boss",emoji:"ğŸ‘¾",hp:6e3,spd:0,dmg:150,val:1e3,color:"#ff00aa",isBoss:!0,range:400,desc:"æ‹¥æœ‰å¤šç§æŠ€èƒ½ã€‚æ¿€å…‰é€ æˆç™¾åˆ†æ¯”ä¼¤å®³ã€‚"}},UI={codexData:{turrets:T_DEFS,enemies:E_DEFS},init(){const t=document.getElementById("star-container");for(let e=0;e<30;e++){const e=document.createElement("div");e.className="star";const s=3*Math.random()+1+"px";e.style.width=s,e.style.height=s,e.style.left=100*Math.random()+"%";const i=10*Math.random()+5;e.style.animationDuration=i+"s",e.style.animationDelay=-Math.random()*i+"s",t.appendChild(e)}},showCodex(){document.getElementById("screen-codex").style.display="flex",this.switchCodexTab("turret")},hideCodex(){document.getElementById("screen-codex").style.display="none"},showLevels(){document.getElementById("screen-levels").style.display="flex"},hideLevels(){document.getElementById("screen-levels").style.display="none"},switchCodexTab(t){const e=document.querySelectorAll(".codex-tab");e.forEach(t=>t.classList.remove("active")),"turret"===t?e[0].classList.add("active"):e[1].classList.add("active");const s=document.getElementById("codex-list"),i="turret"===t?this.codexData.turrets:Object.values(this.codexData.enemies);let l="";i.forEach(e=>{let s="";if("turret"===t){[{key:"ç”Ÿå‘½å€¼",val:e.hp},{key:"é€ ä»·",val:e.cost},{key:"ä¼¤å®³å€¼",val:e.dmg>0?e.dmg:"-"},{key:"èŒƒå›´",val:e.isBomb?"9x9":e.range>0?e.range:"-"},{key:"æ”»å‡»é—´éš”",val:e.cd>0?e.cd:0===e.cd?"ç¬å‘":"-"},{key:"æ²»ç–—é‡",val:e.heal?`${Math.floor(100*e.heal)}%`:null},{key:"ç‰¹æ•ˆå¼ºåº¦",val:e.effectVal?e.effectVal:null}].forEach(t=>{null!==t.val&&void 0!==t.val&&(s+=`<span>${t.key}:</span><span style="text-align:right">${t.val}</span>`)})}else{[{key:"ç”Ÿå‘½å€¼",val:e.hp},{key:"ä¼¤å®³å€¼",val:e.dmg},{key:"é€Ÿåº¦",val:e.spd},{key:"èµé‡‘",val:e.val},{key:"å°„ç¨‹",val:e.range>0?e.range:"è¿‘æˆ˜"}].forEach(t=>s+=`<span>${t.key}:</span><span style="text-align:right">${t.val}</span>`)}l+=`<div class="codex-item"><div class="codex-icon">${e.emoji}</div><div class="codex-info"><h3>${e.name}</h3><div class="codex-stats">${s}</div><p>${e.desc}</p></div></div>`}),s.innerHTML=l}},Game={run:!1,paused:!1,gold:0,hp:0,maxHp:20,wave:0,timer:0,active:!1,selected:null,target:null,turrets:[],enemies:[],bullets:[],parts:[],grid:[],drops:[],bombParticles:[],cell:0,ox:0,oy:0,cvs:null,ctx:null,dpr:1,width:0,height:0,spawnQueue:[],combo:0,comboTimer:0,pressure:1,comboText:{text:"",x:0,y:0,scale:1,alpha:0},init(){this.cvs=document.getElementById("gameCanvas"),this.ctx=this.cvs.getContext("2d"),this.grid=Array(CFG.ROWS).fill(0).map(()=>Array(CFG.COLS).fill(0)),this.resize(),window.addEventListener("resize",()=>this.resize()),this.cvs.addEventListener("click",t=>this.touch(t.clientX,t.clientY)),this.cvs.addEventListener("touchstart",t=>{t.preventDefault(),this.touch(t.touches[0].clientX,t.touches[0].clientY)},{passive:!1}),this.buildShop(),this.loop()},resize(){const t=this.cvs.parentElement,e=t.clientWidth,s=t.clientHeight;this.dpr=window.devicePixelRatio||1,this.cvs.width=e*this.dpr,this.cvs.height=s*this.dpr,this.cvs.style.width=e+"px",this.cvs.style.height=s+"px",this.width=e,this.height=s;const i=s-150;this.cell=Math.max(10,Math.min(Math.floor(e/CFG.COLS),Math.floor(i/CFG.ROWS))),this.ox=(e-this.cell*CFG.COLS)/2,this.oy=50+(i-this.cell*CFG.ROWS)/2,this.run||(this.grid=Array(CFG.ROWS).fill(0).map(()=>Array(CFG.COLS).fill(0)))},buildShop(){const t=document.getElementById("shop");t.innerHTML="",T_DEFS.forEach(e=>{const s=document.createElement("div");s.className="card",s.id=`shop-${e.id}`,s.onclick=()=>this.selectTurret(e.id),s.innerHTML=`<span class="card-cost">${e.cost}</span><span class="card-icon">${e.emoji}</span><span class="card-name">${e.name}</span>`,t.appendChild(s)})},selectTurret(t){if(this.selected===t)this.selected=null;else{const e=T_DEFS.find(e=>e.id===t);this.gold>=e.cost?this.selected=t:this.toast("é‡‘å¸ä¸è¶³")}this.updateShop()},updateShop(){T_DEFS.forEach(t=>{const e=document.getElementById(`shop-${t.id}`);e&&(e.classList.toggle("locked",this.gold<t.cost),e.classList.toggle("selected",this.selected===t.id))})},start(){document.getElementById("screen-start").style.display="none",this.run=!0,this.paused=!1,this.gold=CFG.INIT_GOLD,this.hp=CFG.INIT_HP,this.maxHp=CFG.INIT_HP,this.wave=0,this.turrets=[],this.enemies=[],this.bullets=[],this.parts=[],this.drops=[],this.bombParticles=[],this.grid=Array(CFG.ROWS).fill(0).map(()=>Array(CFG.COLS).fill(0)),this.combo=0,this.comboTimer=0,this.pressure=1,this.comboText={text:"",scale:1,alpha:0},this.nextWave(),this.updateUI()},restart(){document.getElementById("screen-over").style.display="none",this.start()},togglePause(){this.run&&(this.paused=!this.paused,document.getElementById("pauseOverlay").style.display=this.paused?"flex":"none",document.getElementById("pause-text").innerText=this.paused?"ç»§ç»­":"æš‚åœ")},returnToMenu(){this.paused=!1,this.run=!1,document.getElementById("pauseOverlay").style.display="none",document.getElementById("screen-start").style.display="flex"},nextWave(){this.wave++,this.active=!0,this.spawnQueue=[];let t=0;this.hp/this.maxHp>.7&&(t+=1),this.gold>300&&(t+=1),this.pressure=1+.3*t+.05*this.wave,this.pressure=Math.min(this.pressure,3);let e=Math.floor((5+2*this.wave)*this.pressure);const s=1+.15*this.wave,i=1+Math.max(0,.1*(this.wave-15));let l=["ghost"];if(this.wave>2&&l.push("skull"),this.wave>5&&l.push("zombie"),this.wave>8&&l.push("ranger"),this.wave>12&&l.push("tank"),this.wave>6&&l.push("splitter"),this.wave>10&&l.push("healer"),this.wave%5==0){this.spawnQueue.push({type:"boss",mult:.8*s,dmgMult:i});for(let t=0;t<3;t++)this.spawnQueue.push({type:"tank",mult:1,dmgMult:i});e=Math.floor(.5*e)}for(let t=0;t<e;t++){const t=l[Math.floor(Math.random()*l.length)];this.spawnQueue.push({type:t,mult:s,dmgMult:i})}if(this.wave>=21){const t=Math.floor(Math.pow(1.5,this.wave-20)*this.pressure);this.toast(`âš ï¸ æ¶é­”å…¥ä¾µ x${t}`);for(let e=0;e<t;e++)this.spawnQueue.push({type:"demon",mult:1+.1*(this.wave-20),dmgMult:i})}this.updateUI()},logic(){if(this.spawnQueue.length>0&&Math.random()<.03){const t=this.spawnQueue.shift();this.spawnEnemy(t.type,t.mult,t.dmgMult)}this.active&&0===this.enemies.length&&0===this.spawnQueue.length&&(this.active=!1,this.timer=90),!this.active&&this.timer>0&&(this.timer--,this.timer<=0&&this.nextWave()),this.comboTimer>0&&(this.comboTimer--,0===this.comboTimer&&(this.combo=0)),this.comboText.alpha>0&&(this.comboText.alpha-=.02,this.comboText.y-=.5,this.comboText.scale*=.98),this.updateEnemies(),this.updateTurrets(),this.updateBullets(),this.updateParticles(),this.updateDrops(),this.updateBombParticles(),this.hp<=0&&(this.run=!1,document.getElementById("final-score").innerText=this.wave,document.getElementById("screen-over").style.display="flex")},spawnEnemy(t,e,s){const i=E_DEFS[t],l=Math.floor(Math.random()*CFG.COLS),a=this.ox+(l+.5)*this.cell,o=this.oy-this.cell,h=!i.isBoss&&Math.random()<.05,r=h?2:1,n={x:a,y:o,def:i,hp:i.hp*e*r,maxHp:i.hp*e*r,spd:i.spd,dmg:i.dmg*(s||1),val:i.val*r,state:"move",target:null,timer:0,stunTimer:0,slowTimer:0,freezeTimer:0,repelTimer:0,isElite:h,attackMode:0,chargeTimer:0,laserY:0,laserTimer:0,laserProtected:!1,healTimer:0,empActive:!1,empTargetY:0};if(i.isBoss){const t=1<<Math.floor(this.wave/5)-1;n.demonQuota=t,n.summonCooldown=120,this.toast(`ğŸ‘¾ Bosså‡ºç°ï¼æ¶é­”é…é¢: ${t}`)}this.enemies.push(n)},updateEnemies(){const t=this.oy+CFG.ROWS*this.cell,e=this.oy+.5*this.cell;for(let s=this.enemies.length-1;s>=0;s--){const i=this.enemies[s];if(i.hp<=0){if("splitter"===i.def.id){const t=Math.floor((i.x-this.ox)/this.cell),e=Math.floor((i.y-this.oy)/this.cell),s=[];for(let i=-1;i<=1;i++)for(let l=-1;l<=1;l++){const a=e+i,o=t+l;a>=0&&a<CFG.ROWS&&o>=0&&o<CFG.COLS&&s.push({x:this.ox+(o+.5)*this.cell,y:this.oy+(a+.5)*this.cell})}for(let t=s.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[s[t],s[e]]=[s[e],s[t]]}const l=Math.min(2,s.length);for(let t=0;t<l;t++)this.enemies.push({x:s[t].x,y:s[t].y,def:E_DEFS.ghost,hp:.5*E_DEFS.ghost.hp,maxHp:.5*E_DEFS.ghost.hp,spd:E_DEFS.ghost.spd,dmg:E_DEFS.ghost.dmg,val:5,state:"move",target:null,timer:0,stunTimer:0,slowTimer:0,freezeTimer:0,repelTimer:0,empActive:!1});this.toast("ğŸ¦  åˆ†è£‚ä½“åˆ†è£‚äº†ï¼")}this.addKillReward(i),Math.random()<(i.isElite?1:.05)&&this.spawnDrop(i.x,i.y),this.spawnParts(i.x,i.y,i.def.color,10),this.enemies.splice(s,1),this.updateUI();continue}if(i.empActive){i.y-=15,this.enemies.forEach(t=>{t!==i&&!t.def.isBoss&&Math.abs(t.x-i.x)<.5*this.cell&&Math.abs(t.y-i.y)<.5*this.cell&&(t.hp-=50,this.spawnParts(t.x,t.y,"#ffff00",2))}),i.y<=i.empTargetY&&(i.y=i.empTargetY,i.empActive=!1);continue}if(i.freezeTimer>0){i.freezeTimer--;continue}if(i.stunTimer>0){i.stunTimer--;continue}if(i.repelTimer>0){i.repelTimer--;continue}if(i.def.isBoss){this.updateBoss(i);continue}if("healer"===i.def.id&&(i.healTimer++,i.healTimer>120&&(this.enemies.forEach(t=>{t!==i&&Math.hypot(t.x-i.x,t.y-i.y)<i.def.range&&(t.hp+=.1*t.maxHp,this.spawnParts(t.x,t.y,"#FF69B4",3))}),i.healTimer=0)),"ranger"===i.def.id){if(i.y<e?i.y+=i.spd:i.y=e,i.y>=this.oy){if(!i.target||i.target.hp<=0){let t=i.def.range;this.turrets.forEach(e=>{const s=Math.hypot(e.x-i.x,e.y-i.y);s<t&&(t=s,i.target=e)})}i.target&&(i.timer++,i.timer>60&&(this.bullets.push({x:i.x,y:i.y,tgt:i.target,spd:5,dmg:i.dmg,color:"#ff8800",enemy:!0}),i.timer=0))}continue}const l=i.y>=this.oy;if(i.def.range>100&&l){if(!i.target||i.target.hp<=0){let t=i.def.range;this.turrets.forEach(e=>{const s=Math.hypot(e.x-i.x,e.y-i.y);s<t&&(t=s,i.target=e)})}i.target&&(i.timer++,i.timer>60&&(this.bullets.push({x:i.x,y:i.y,tgt:i.target,spd:5,dmg:i.dmg,color:"#ff8800",enemy:!0}),i.timer=0));const t=this.oy+.5*this.cell;i.y<t&&(i.y+=i.spd)}else if("move"===i.state){let e=i.y+i.spd;i.slowTimer>0&&(e*=.5,i.slowTimer--);let l=!1;for(let t of this.turrets)if(Math.abs(i.x-t.x)<.8*this.cell&&Math.abs(e-t.y)<.8*this.cell){l=!0,i.target=t,i.state="atk";break}if(!l&&(i.y=e,i.y>t)){this.hp--,this.enemies.splice(s,1),this.updateUI();continue}}else"atk"===i.state&&(!i.target||i.target.hp<=0?(i.state="move",i.target=null):(i.timer++,i.timer>40&&(i.target.hp-=i.dmg,this.spawnParts(i.target.x,i.target.y,"#f00",3),i.timer=0)))}},updateBoss(t){if(t.timer++,t.demonQuota>0){t.summonCooldown--;const e=40+t.hp/t.maxHp*80;if(t.summonCooldown<=0){const s=Math.floor(Math.random()*CFG.COLS),i=this.ox+(s+.5)*this.cell,l=this.oy-this.cell;this.enemies.push({x:i,y:l,def:E_DEFS.demon,hp:.5*E_DEFS.demon.hp,maxHp:.5*E_DEFS.demon.hp,spd:E_DEFS.demon.spd,dmg:E_DEFS.demon.dmg,val:100,state:"move",target:null,timer:0,stunTimer:0,slowTimer:0,freezeTimer:0,repelTimer:0,empActive:!1}),t.demonQuota--,this.spawnParts(i,l,"#ff0000",10),this.toast("ğŸ‘¹ Bosså¬å”¤äº†æ¶é­”ï¼"),t.summonCooldown=e}}if(t.y<this.oy+2*this.cell&&(t.y+=.5),t.laserTimer>0&&t.laserTimer--,t.y>=this.oy+2*this.cell)if(0===t.attackMode){if(t.timer%20==0)for(let e=0;e<8;e++){const s=2*Math.PI/8*e+.05*t.timer;this.bullets.push({x:t.x,y:t.y,vx:3*Math.cos(s),vy:3*Math.sin(s),dmg:30,color:"#f0f",enemy:!0})}t.timer>180&&(t.attackMode=1,t.timer=0,t.chargeTimer=0)}else if(1===t.attackMode){if(0===t.chargeTimer){const e=Math.floor(Math.random()*CFG.ROWS);t.laserY=this.oy+(e+.5)*this.cell,this.toast("âš ï¸ Bossè“„åŠ›ä¸­...")}if(t.chargeTimer++,t.chargeTimer>90){let e=!1;this.turrets.forEach(s=>{Math.abs(s.y-t.laserY)<.5*this.cell&&s.def.isSupport&&(e=!0)}),t.laserTimer=30,t.laserProtected=e,e?(this.toast("ğŸ›¡ï¸ ä¿®å¤ç‚®å¡”å®Œå…¨æ‹¦æˆªäº†æ¿€å…‰ï¼"),this.spawnParts(t.x,t.laserY,"#00ff88",20)):this.turrets.forEach(e=>{if(Math.abs(e.y-t.laserY)<.5*this.cell){let t=!1;this.turrets.forEach(s=>{if(s===e||!s.def.isSupport)return;const i=Math.abs(e.r-s.r),l=Math.abs(e.c-s.c);i<=1&&l<=1&&(t=!0)});let s=.5;e.def.isWall&&(s=.25),t&&(s*=.5);const i=e.maxHp*s;e.hp-=i,this.spawnParts(e.x,e.y,t?"#00ff88":"#ff0000",5)}}),t.attackMode=0,t.timer=0,t.chargeTimer=0}}},addKillReward(t){this.combo++,this.comboTimer=60;let e=Math.floor(this.combo/5);this.gold+=Math.floor(t.val*(.8+.4*Math.random()))+e,this.combo>1&&(this.comboText.text=`${this.combo} COMBO! +${e}`,this.comboText.x=this.width/2,this.comboText.y=.3*this.height,this.comboText.scale=1.5,this.comboText.alpha=1)},spawnDrop(t,e){const s=["gold","gold","heal"];Math.random()<.1&&s.push("nuke"),Math.random()<.1&&s.push("frenzy");let i=s[Math.floor(Math.random()*s.length)];"heal"===i&&this.maxHp>=30&&(i="gold"),this.drops.push({x:t,y:e,type:i,timer:0,life:600})},updateDrops(){for(let t=this.drops.length-1;t>=0;t--)this.drops[t].timer++,this.drops[t].timer>this.drops[t].life&&this.drops.splice(t,1)},collectDrop(t){const e=this.drops[t];"heal"===e.type?this.hp>=this.maxHp?(this.maxHp++,this.hp++,this.toast("+1 æœ€å¤§ç”Ÿå‘½å€¼!")):(this.hp++,this.toast("+1 HP")):"nuke"===e.type?(this.toast("ğŸ’£ å±å¹•æ¸…é™¤ï¼"),this.enemies.forEach(t=>{t.hp-=9999,this.spawnParts(t.x,t.y,"#ff8800",3)})):"frenzy"===e.type?(this.toast("âš¡ ç‚®å¡”æ¿€æ€’ï¼"),this.turrets.forEach(t=>{t.maxCd=Math.max(1,.5*t.maxCd),t.frenzyTimer=600})):this.gold+=Math.floor(15+16*Math.random()),this.spawnParts(e.x,e.y,"heal"===e.type?"#ff3366":"#ffd700",5),this.drops.splice(t,1),this.updateUI()},updateBombParticles(){for(let t=this.bombParticles.length-1;t>=0;t--){const e=this.bombParticles[t];e.x+=e.vx,e.y+=e.vy,e.life--,e.vx*=.95,e.vy*=.95,e.life<=0&&this.bombParticles.splice(t,1)}},updateTurrets(){for(let t=this.turrets.length-1;t>=0;t--){const e=this.turrets[t];if(e.frenzyTimer>0&&e.frenzyTimer--,e.hp<=0){this.grid[e.r][e.c]=0,this.spawnParts(e.x,e.y,"#555",10),this.turrets.splice(t,1);continue}if(e.def.isSupport){if(e.cd>0){e.cd--;continue}let t=!1;this.turrets.forEach(s=>{if(s===e||s.hp<=0)return;Math.hypot(s.x-e.x,s.y-e.y)<e.range&&s.hp<s.maxHp&&(s.hp+=s.maxHp*e.heal,s.hp>s.maxHp&&(s.hp=s.maxHp),t=!0)}),t&&(e.cd=e.maxCd);continue}if(e.def.isLaser){e.targets=[],this.enemies.forEach(t=>{Math.hypot(t.x-e.x,t.y-e.y)<e.range&&(t.hp-=e.dmg,e.targets.push(t))});continue}if(0===e.def.dmg)continue;if(e.cd>0){e.cd--;continue}let s=null,i=e.range;this.enemies.forEach(t=>{const l=Math.hypot(t.x-e.x,t.y-e.y);l<i&&(i=l,s=t)}),s&&(this.bullets.push({x:e.x,y:e.y,tgt:s,spd:8,dmg:e.dmg,color:e.def.color,effect:e.def.effect,effectVal:e.effectVal||0}),e.cd=e.maxCd)}},updateBullets(){for(let t=this.bullets.length-1;t>=0;t--){const e=this.bullets[t];if(e.enemy){if(e.tgt){if(e.tgt.hp<=0){this.bullets.splice(t,1);continue}const s=e.tgt.x-e.x,i=e.tgt.y-e.y,l=Math.hypot(s,i);l<10?(e.tgt.hp-=e.dmg,this.spawnParts(e.x,e.y,"#f00",3),this.bullets.splice(t,1)):(e.x+=s/l*e.spd,e.y+=i/l*e.spd)}else{if(e.x+=e.vx,e.y+=e.vy,e.y>this.height||e.y<0){this.bullets.splice(t,1);continue}for(let s of this.turrets)if(Math.hypot(s.x-e.x,s.y-e.y)<this.cell/2){s.hp-=e.dmg,this.bullets.splice(t,1);break}}continue}if(!e.tgt||e.tgt.hp<=0){this.bullets.splice(t,1);continue}const s=e.tgt.x-e.x,i=e.tgt.y-e.y,l=Math.hypot(s,i);if(l<10){if(e.tgt.hp-=e.dmg,"freeze"===e.effect)e.tgt.def.isBoss?e.tgt.freezeTimer=6:e.tgt.freezeTimer=e.effectVal;else if("repel"===e.effect)if(e.tgt.def.isBoss){const t=this.enemies.filter(t=>!t.def.isBoss);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];this.castEMP(e)}}else this.castEMP(e.tgt);this.spawnParts(e.x,e.y,e.color,3),this.bullets.splice(t,1)}else e.x+=s/l*e.spd,e.y+=i/l*e.spd}},castEMP(t){t.empActive=!0,t.empTargetY=this.oy+.5*this.cell,t.freezeTimer=0,t.stunTimer=0,this.spawnParts(t.x,t.y,"#ffff00",10)},updateParticles(){for(let t=this.parts.length-1;t>=0;t--){const e=this.parts[t];e.x+=e.vx,e.y+=e.vy,e.life--,e.life<=0&&this.parts.splice(t,1)}},spawnParts(t,e,s,i){for(let l=0;l<i;l++)this.parts.push({x:t,y:e,color:s,vx:4*(Math.random()-.5),vy:4*(Math.random()-.5),life:20})},touch(t,e){if(!this.run||this.paused)return;const s=this.cvs.getBoundingClientRect(),i=t-s.left,l=e-s.top;for(let t=this.drops.length-1;t>=0;t--){const e=this.drops[t];if(Math.hypot(e.x-i,e.y-l)<.6*this.cell)return void this.collectDrop(t)}const a=Math.floor((i-this.ox)/this.cell),o=Math.floor((l-this.oy)/this.cell);if(a<0||a>=CFG.COLS||o<0||o>=CFG.ROWS)return;const h=this.turrets.find(t=>t.c===a&&t.r===o);if(h)return this.showMenu(h,t,e),void(h.bounce=5);if(this.closeMenu(),this.selected){const t=T_DEFS.find(t=>t.id===this.selected);this.gold>=t.cost&&(t.isBomb?this.placeBomb(o,a,t):0===this.grid[o][a]&&this.placeTurret(o,a,t))}},placeBomb(t,e,s){this.gold-=s.cost;const i=this.ox+(e+.5)*this.cell,l=this.oy+(t+.5)*this.cell;for(let t=0;t<40;t++){const t=Math.random()*Math.PI*2,e=8*Math.random()+2;this.bombParticles.push({x:i,y:l,vx:Math.cos(t)*e,vy:Math.sin(t)*e,life:30+20*Math.random(),color:Math.random()>.5?"#ff8800":"#ffff00"})}this.enemies.forEach(t=>{const e=Math.abs(t.x-i),a=Math.abs(t.y-l);e<=s.range*this.cell&&a<=s.range*this.cell&&(t.hp=0)}),this.selected=null,this.updateUI()},placeTurret(t,e,s){this.gold-=s.cost,this.grid[t][e]=1;const i=this.ox+(e+.5)*this.cell,l=this.oy+(t+.5)*this.cell,a={r:t,c:e,x:i,y:l,def:s,hp:s.hp,maxHp:s.hp,dmg:s.dmg,cd:0,lvl:1,range:s.range,heal:s.heal||0,effectVal:s.effectVal||0,maxCd:s.cd,targets:[],bounce:5,frenzyTimer:0};this.turrets.push(a),this.spawnParts(i,l,"#fff",5),this.selected=null,this.updateUI()},showMenu(t,e,s){this.target=t;const i=Math.floor(t.def.cost*Math.pow(1.5,t.lvl)),l=Math.floor(.6*t.def.cost*t.lvl);let a=`<div style="color:#aaa; margin-bottom:5px;">ç­‰çº§: <span style="color:#fff">${t.lvl}</span></div><div class="info-grid">`;a+=`<span class="info-key">ç”Ÿå‘½å€¼:</span><span class="info-val">${Math.ceil(t.hp)}/${t.maxHp}</span>`,t.def.dmg>0&&(a+=`<span class="info-key">ä¼¤å®³å€¼:</span><span class="info-val">${Math.floor(t.dmg)}</span>`),t.def.range>0&&(a+=`<span class="info-key">å°„ç¨‹:</span><span class="info-val">${Math.floor(t.range)}</span>`),t.def.cd>0&&(a+=`<span class="info-key">æ”»å‡»é—´éš”:</span><span class="info-val">${t.maxCd}</span>`),t.def.isSupport&&(a+=`<span class="info-key">æ²»ç–—é‡:</span><span class="info-val">${Math.floor(100*t.heal)}%</span>`),t.def.isLaser&&(a+=`<span class="info-key">ç§’ä¼¤:</span><span class="info-val">${Math.floor(60*t.dmg)}</span>`),t.def.effect&&(a+=`<span class="info-key">ç‰¹æ•ˆå¼ºåº¦:</span><span class="info-val">${t.effectVal}</span>`),a+="</div>",document.getElementById("ctx-title").innerText=`${t.def.emoji} ${t.def.name}`,document.getElementById("ctx-info").innerHTML=a,document.getElementById("ctx-cost").innerText=i,document.getElementById("ctx-sell").innerText=l,document.getElementById("ctxMenu").style.display="flex"},closeMenu(){document.getElementById("ctxMenu").style.display="none",this.target=null},upgrade(){if(!this.target)return;const t=this.target,e=Math.floor(t.def.cost*Math.pow(1.5,t.lvl));if(this.gold>=e){this.gold-=e,t.lvl++;const s=t.def.upg;let i=.2*t.def.hp;s&&s.hp&&(i+=s.hp),t.maxHp+=i,t.hp=t.maxHp,s&&(s.dmg&&(t.dmg+=s.dmg),s.cd&&(t.maxCd=Math.max(1,t.maxCd+s.cd)),s.range&&(t.range+=s.range),s.heal&&(t.heal+=s.heal),s.effectVal&&(t.effectVal+=s.effectVal)),t.bounce=5,this.updateUI(),this.spawnParts(t.x,t.y,"#ffd700",5)}this.closeMenu()},sell(){if(!this.target)return;const t=this.target;this.gold+=Math.floor(.6*t.def.cost*t.lvl),this.grid[t.r][t.c]=0,this.turrets=this.turrets.filter(e=>e!==t),this.updateUI(),this.closeMenu()},updateUI(){document.getElementById("s-gold").innerText=this.gold,document.getElementById("s-hp").innerText=this.hp,document.getElementById("s-maxhp").innerText=this.maxHp,document.getElementById("s-wave").innerText=this.wave,this.updateShop()},toast(t){const e=document.getElementById("toast");e.innerText=t,e.style.opacity=1,setTimeout(()=>e.style.opacity=0,1500)},loop(){this.run&&!this.paused&&this.logic(),this.draw(),requestAnimationFrame(()=>this.loop())},draw(){const t=this.ctx,e=this.width,s=this.height,i=this.dpr;t.save(),t.setTransform(i,0,0,i,0,0),t.clearRect(0,0,e,s),t.strokeStyle="rgba(0, 242, 255, 0.1)",t.lineWidth=1;for(let e=0;e<=CFG.COLS;e++){const s=Math.floor(this.ox+e*this.cell);t.beginPath(),t.moveTo(s,this.oy),t.lineTo(s,this.oy+CFG.ROWS*this.cell),t.stroke()}for(let e=0;e<=CFG.ROWS;e++){const s=Math.floor(this.oy+e*this.cell);t.beginPath(),t.moveTo(this.ox,s),t.lineTo(this.ox+CFG.COLS*this.cell,s),t.stroke()}t.fillStyle="rgba(0, 255, 136, 0.1)",t.fillRect(this.ox,this.oy+CFG.ROWS*this.cell,CFG.COLS*this.cell,this.cell),t.fillStyle="#0f8",t.font="12px Orbitron",t.textAlign="center",t.fillText("BASE",e/2,this.oy+CFG.ROWS*this.cell+this.cell/2);const l=this.enemies.find(t=>t.def.isBoss);if(l&&(1===l.attackMode&&l.chargeTimer>0&&(t.fillStyle=`rgba(255, 0, 0, ${.1+l.chargeTimer/150})`,t.fillRect(this.ox,l.laserY-this.cell/2,CFG.COLS*this.cell,this.cell)),l.laserTimer>0)){const s=l.laserTimer/30;l.laserProtected?(t.fillStyle=`rgba(0, 255, 136, ${.8*s})`,t.fillRect(this.ox,l.laserY-this.cell/2,CFG.COLS*this.cell,this.cell),t.fillStyle="#fff",t.font="bold 20px Orbitron",t.textAlign="center",t.fillText("SHIELDED",e/2,l.laserY)):(t.fillStyle=`rgba(255, 0, 0, ${.8*s})`,t.fillRect(this.ox,l.laserY-this.cell/2,CFG.COLS*this.cell,this.cell))}this.turrets.forEach(e=>{if(this.selected&&e.def.id===this.selected){const s=hexToRgb(e.def.color);t.fillStyle=`rgba(${s.r}, ${s.g}, ${s.b}, 0.15)`,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),e.range,0,2*Math.PI),t.fill(),t.strokeStyle=e.def.color,t.lineWidth=1,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),e.range,0,2*Math.PI),t.stroke()}if(e.def.isLaser&&e.targets.length>0&&(t.strokeStyle=e.def.color,t.lineWidth=2,t.shadowBlur=10,t.shadowColor=e.def.color,e.targets.forEach(s=>{t.beginPath(),t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(s.x),Math.floor(s.y)),t.stroke()}),t.shadowBlur=0),e.def.isSupport&&e.cd>0){const s=hexToRgb(e.def.color);t.fillStyle=`rgba(${s.r}, ${s.g}, ${s.b}, 0.1)`,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),e.range,0,2*Math.PI),t.fill()}e.bounce>0&&e.bounce--;const s=1+.02*e.bounce,i=-e.bounce;if(t.save(),t.translate(Math.floor(e.x),Math.floor(e.y)+i),t.scale(s,s),e.def.isWall){const s=.5*this.cell;t.fillStyle=darkenColor(e.def.color,.2),t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.fill(),t.strokeStyle=e.def.color,t.lineWidth=2,t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.stroke(),t.font=`${Math.floor(.8*s)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.def.emoji,0,0)}else{const s=.4*this.cell,i=2;if(t.fillStyle=darkenColor(e.def.color,.2),t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.fill(),e.def.cd>0&&!e.def.isSupport&&!e.def.isLaser&&!e.def.isBomb){t.strokeStyle=`rgba(${hexToRgb(e.def.color).r}, ${hexToRgb(e.def.color).g}, ${hexToRgb(e.def.color).b}, 0.3)`,t.lineWidth=i,t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.stroke();const l=1-e.cd/e.maxCd;t.strokeStyle=e.def.color,t.lineWidth=i,t.beginPath(),t.arc(0,0,s,-Math.PI/2,-Math.PI/2+2*Math.PI*l),t.stroke()}else t.strokeStyle=e.def.color,t.lineWidth=i,t.beginPath(),t.arc(0,0,s,0,2*Math.PI),t.stroke();t.fillStyle="#fff",t.font=`${Math.floor(.8*s)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.def.emoji,0,1)}if(t.restore(),e.hp<e.maxHp){const s=Math.floor(e.x-15),i=Math.floor(e.y-25);t.fillStyle="#000",t.fillRect(s,i,30,4),t.fillStyle="#0f0",t.fillRect(s,i,e.hp/e.maxHp*30,4)}}),this.bombParticles.forEach(e=>{t.globalAlpha=e.life/50,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,3,0,2*Math.PI),t.fill()}),t.globalAlpha=1,this.enemies.forEach(e=>{e.isElite&&(t.fillStyle="rgba(255, 215, 0, 0.2)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.7*this.cell,0,2*Math.PI),t.fill()),e.freezeTimer>0&&(t.fillStyle="rgba(102, 204, 255, 0.5)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.6*this.cell,0,2*Math.PI),t.fill()),e.empActive&&(t.fillStyle="rgba(255, 255, 0, 0.5)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.6*this.cell,0,2*Math.PI),t.fill()),t.fillStyle=e.def.color,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.4*this.cell,0,2*Math.PI),t.fill(),t.fillStyle="rgba(0,0,0,0.5)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.35*this.cell,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.font=`${e.def.isBoss?40:Math.floor(.5*this.cell)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.def.emoji,Math.floor(e.x),Math.floor(e.y));t.fillStyle="#000",t.fillRect(Math.floor(e.x-15),Math.floor(e.y-20),30,3),t.fillStyle="#f00",t.fillRect(Math.floor(e.x-15),Math.floor(e.y-20),e.hp/e.maxHp*30,3)}),this.drops.forEach(e=>{const s=12+2*Math.sin(.1*e.timer);t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),s+5,0,2*Math.PI),t.fillStyle="heal"===e.type?"rgba(255, 50, 100, 0.3)":"nuke"===e.type?"rgba(255, 100, 0, 0.3)":"frenzy"===e.type?"rgba(255, 255, 0, 0.3)":"rgba(255, 215, 0, 0.3)",t.fill(),t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),s,0,2*Math.PI),t.fillStyle="heal"===e.type?"#ff3366":"nuke"===e.type?"#ff8800":"frenzy"===e.type?"#ffff00":"#ffd700",t.fill(),t.font="14px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("heal"===e.type?"â¤ï¸":"nuke"===e.type?"ğŸ’£":"frenzy"===e.type?"âš¡":"ğŸ’°",Math.floor(e.x),Math.floor(e.y))}),this.bullets.forEach(e=>{t.fillStyle=e.color,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),3,0,2*Math.PI),t.fill()}),this.parts.forEach(e=>{t.globalAlpha=e.life/20,t.fillStyle=e.color,t.fillRect(Math.floor(e.x),Math.floor(e.y),2,2)}),t.globalAlpha=1,this.comboText.alpha>0&&(t.save(),t.globalAlpha=this.comboText.alpha,t.translate(this.comboText.x,this.comboText.y),t.scale(this.comboText.scale,this.comboText.scale),t.font="bold 24px Orbitron",t.textAlign="center",t.fillStyle="#ffd700",t.shadowColor="#ff0000",t.shadowBlur=10,t.fillText(this.comboText.text,0,0),t.restore()),t.restore()}};UI.init(),Game.init()</script></body></html>