<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Ê∑±Á©∫Èò≤Á∫ø - ÊàòÊúØÈù©Êñ∞</title><link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet"><style>:root{--bg:#0a0e17;--accent:#00f2ff;--danger:#ff3366;--gold:#ffd700;--green:#00ff88;--purple:#bf00ff}*{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-tap-highlight-color:transparent}body{font-family:'Noto Sans SC',sans-serif;background:#000;color:#fff;overflow:hidden;height:100vh;width:100vw}#app{width:100%;height:100%;position:relative;display:flex;flex-direction:column}canvas{display:block;position:absolute;top:0;left:0;z-index:1;background-color:var(--bg)}.ui-layer{position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none;display:flex;flex-direction:column}.header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:linear-gradient(to bottom,rgba(0,0,0,.8),transparent);pointer-events:auto}.stat{font-family:Orbitron,monospace;font-weight:700;font-size:14px;display:flex;align-items:center;gap:5px;text-shadow:0 0 5px currentColor}.pause-btn{background:rgba(0,0,0,.5);border:1px solid var(--accent);color:var(--accent);padding:5px 10px;border-radius:4px;cursor:pointer;font-family:Orbitron;font-size:12px;display:flex;align-items:center;gap:5px}.pause-btn:active{background:rgba(0,242,255,.2)}.footer{margin-top:auto;height:100px;background:rgba(10,15,25,.95);border-top:1px solid rgba(0,242,255,.2);pointer-events:auto;padding:10px;display:flex;flex-direction:column}.shop-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:4px;flex:1}.card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;position:relative;padding:2px}.card.selected{border-color:var(--accent);background:rgba(0,242,255,.1);box-shadow:0 0 10px rgba(0,242,255,.2)}.card.locked{opacity:.3;pointer-events:none}.card-icon{font-size:18px;line-height:1}.card-name{font-size:8px;color:#888;margin-top:1px}.card-cost{position:absolute;top:1px;right:2px;font-size:8px;color:var(--gold);font-family:Orbitron}.modal-bg{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:100;pointer-events:auto}.modal{background:#151c28;border:1px solid var(--accent);padding:20px;border-radius:8px;text-align:center;min-width:220px;box-shadow:0 0 30px rgba(0,0,0,.5)}.modal h2{margin-bottom:10px;color:var(--accent)}.btn{background:0 0;border:1px solid var(--accent);color:var(--accent);padding:8px 20px;margin:5px;cursor:pointer;font-family:Orbitron;font-size:12px}.btn-danger{border-color:var(--danger);color:var(--danger)}.btn-success{border-color:var(--green);color:var(--green)}.toast{position:absolute;top:20%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.8);color:var(--accent);padding:10px 20px;border-radius:4px;font-family:Orbitron;opacity:0;transition:opacity .3s;pointer-events:none;border:1px solid var(--accent);z-index:200}#pauseOverlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);z-index:50;display:none;flex-direction:column;align-items:center;justify-content:center;pointer-events:auto;color:var(--accent);font-family:Orbitron}#pauseOverlay h1{font-size:32px;margin-bottom:20px;text-shadow:0 0 10px var(--accent)}</style></head><body><div id="app"><canvas id="gameCanvas"></canvas><div class="ui-layer"><div class="header"><div class="stat" style="color:var(--gold)">üí∞ <span id="s-gold">300</span></div><div class="stat" style="color:var(--accent)">WAVE <span id="s-wave">0</span></div><div class="stat" style="color:var(--danger)">‚ù§Ô∏è <span id="s-hp">20</span></div><button class="pause-btn" onclick="Game.togglePause()">‚è∏Ô∏è <span id="pause-text">ÊöÇÂÅú</span></button></div><div id="toast" class="toast"></div><div class="footer"><div class="shop-grid" id="shop"></div></div></div><div id="pauseOverlay"><h1>PAUSED</h1><p style="color:#888;margin-bottom:20px">Ê∏∏ÊàèÂ∑≤ÊöÇÂÅú</p><button class="btn" onclick="Game.togglePause()">ÁªßÁª≠Ê∏∏Êàè</button></div><div id="ctxMenu" class="modal-bg"><div class="modal"><h2 id="ctx-title">ÁÇÆÂ°î</h2><p style="font-size:12px;color:#888;margin-bottom:10px" id="ctx-info"></p><button class="btn btn-success" onclick="Game.upgrade()">ÂçáÁ∫ß ($<span id="ctx-cost">0</span>)</button> <button class="btn btn-danger" onclick="Game.sell()">Âá∫ÂîÆ (+$<span id="ctx-sell">0</span>)</button> <button class="btn" onclick="Game.closeMenu()">ÂÖ≥Èó≠</button></div></div><div id="screen-start" class="modal-bg" style="display:flex"><div class="modal"><h1 style="font-size:24px;margin-bottom:10px">DEEP SPACE</h1><p style="color:#555;margin-bottom:20px">ÊàòÊúØÈù©Êñ∞ v5.1</p><button class="btn" style="font-size:16px;padding:10px 30px" onclick="Game.start()">ÂºÄÂßãÊ∏∏Êàè</button></div></div><div id="screen-over" class="modal-bg" style="display:none"><div class="modal"><h1 style="color:var(--danger)">GAME OVER</h1><p style="margin:10px 0">Èò≤Á∫øÂ¥©Ê∫É</p><p>ÊúÄÈ´òÊ≥¢Ê¨°: <span id="final-score" style="color:var(--accent)">0</span></p><button class="btn" style="margin-top:10px" onclick="Game.restart()">ÈáçÊñ∞ÂºÄÂßã</button></div></div></div><script>const CFG={COLS:7,ROWS:9,INIT_GOLD:300,INIT_HP:20},T_DEFS=[{id:"wall",name:"Â¢ô",cost:25,hp:2e3,dmg:0,range:0,cd:0,emoji:"üß±",color:"#555",isWall:!0,upg:{hp:1e3}},{id:"gun",name:"Êú∫Êû™",cost:50,hp:200,dmg:15,range:150,cd:15,emoji:"üî´",color:"#00f2ff",upg:{dmg:3,cd:-1}},{id:"sniper",name:"ÁãôÂáª",cost:100,hp:100,dmg:150,range:350,cd:70,emoji:"üéØ",color:"#ff3366",upg:{dmg:40,range:15}},{id:"frost",name:"ÂÜ∞ÂÜª",cost:75,hp:150,dmg:5,range:150,cd:20,emoji:"‚ùÑÔ∏è",color:"#00ffff",effect:"slow",effectVal:120,upg:{range:10,effectVal:20}},{id:"laser",name:"ÊøÄÂÖâ",cost:200,hp:180,dmg:1,range:220,cd:0,emoji:"‚ö°",color:"#bf00ff",isLaser:!0,upg:{dmg:.2,range:10}},{id:"support",name:"‰øÆÂ§ç",cost:180,hp:120,heal:.02,range:150,cd:60,emoji:"üõ†Ô∏è",color:"#00ff88",isSupport:!0,upg:{heal:.005,range:10}},{id:"emp",name:"ÁîµÁ£Å",cost:180,hp:120,dmg:10,range:180,cd:50,emoji:"‚ò¢Ô∏è",color:"#ffff00",effect:"stun",effectVal:60,upg:{effectVal:10,range:5}},{id:"bomb",name:"ÁÇ∏Âºπ",cost:100,hp:1,dmg:1e3,range:120,cd:0,emoji:"üí£",color:"#ff8800",isBomb:!0,upg:{}}],E_DEFS={ghost:{emoji:"üëª",hp:60,spd:1.5,dmg:30,val:15,color:"#aaf",range:0},zombie:{emoji:"üßü",hp:250,spd:.8,dmg:60,val:25,color:"#5f5",range:0},skull:{emoji:"üíÄ",hp:100,spd:2.5,dmg:20,val:20,color:"#fff",range:0},tank:{emoji:"ü§ñ",hp:600,spd:.5,dmg:80,val:50,color:"#888",range:0},ranger:{emoji:"üèπ",hp:150,spd:1,dmg:100,val:40,color:"#ff9933",range:200},demon:{emoji:"üëπ",hp:8e3,spd:.4,dmg:250,val:300,color:"#ff0000",range:50},boss:{emoji:"üëæ",hp:1e4,spd:0,dmg:150,val:1e3,color:"#ff00aa",isBoss:!0,range:400}},Game={run:!1,paused:!1,gold:0,hp:0,wave:0,timer:0,active:!1,selected:null,target:null,turrets:[],enemies:[],bullets:[],parts:[],grid:[],cell:0,ox:0,oy:0,cvs:null,ctx:null,dpr:1,width:0,height:0,spawnQueue:[],init(){this.cvs=document.getElementById("gameCanvas"),this.ctx=this.cvs.getContext("2d"),this.grid=Array(CFG.ROWS).fill(0).map(()=>Array(CFG.COLS).fill(0)),this.resize(),window.addEventListener("resize",()=>this.resize()),this.cvs.addEventListener("click",t=>this.touch(t.clientX,t.clientY)),this.cvs.addEventListener("touchstart",t=>{t.preventDefault(),this.touch(t.touches[0].clientX,t.touches[0].clientY)},{passive:!1}),this.buildShop(),this.loop()},resize(){const t=this.cvs.parentElement,e=t.clientWidth,s=t.clientHeight;this.dpr=window.devicePixelRatio||1,this.cvs.width=e*this.dpr,this.cvs.height=s*this.dpr,this.cvs.style.width=e+"px",this.cvs.style.height=s+"px",this.width=e,this.height=s;const i=s-150,l=Math.floor(e/CFG.COLS),h=Math.floor(i/CFG.ROWS);this.cell=Math.max(10,Math.min(l,h)),this.ox=(e-this.cell*CFG.COLS)/2,this.oy=50+(i-this.cell*CFG.ROWS)/2,this.run||(this.grid=Array(CFG.ROWS).fill(0).map(()=>Array(CFG.COLS).fill(0)))},buildShop(){const t=document.getElementById("shop");t.innerHTML="",T_DEFS.forEach(e=>{const s=document.createElement("div");s.className="card",s.id=`shop-${e.id}`,s.onclick=()=>this.selectTurret(e.id),s.innerHTML=`<span class="card-cost">${e.cost}</span><span class="card-icon">${e.emoji}</span><span class="card-name">${e.name}</span>`,t.appendChild(s)})},selectTurret(t){const e=T_DEFS.find(e=>e.id===t);this.gold>=e.cost?(this.selected=t,this.updateShop()):this.toast("ÈáëÂ∏Å‰∏çË∂≥")},updateShop(){T_DEFS.forEach(t=>{const e=document.getElementById(`shop-${t.id}`);e&&(e.classList.toggle("locked",this.gold<t.cost),e.classList.toggle("selected",this.selected===t.id))})},start(){document.getElementById("screen-start").style.display="none",this.run=!0,this.paused=!1,this.gold=CFG.INIT_GOLD,this.hp=CFG.INIT_HP,this.wave=0,this.turrets=[],this.enemies=[],this.bullets=[],this.parts=[],this.grid=Array(CFG.ROWS).fill(0).map(()=>Array(CFG.COLS).fill(0)),this.nextWave(),this.updateUI()},restart(){document.getElementById("screen-over").style.display="none",this.start()},togglePause(){this.run&&(this.paused=!this.paused,document.getElementById("pauseOverlay").style.display=this.paused?"flex":"none",document.getElementById("pause-text").innerText=this.paused?"ÁªßÁª≠":"ÊöÇÂÅú")},nextWave(){this.wave++,this.active=!0,this.spawnQueue=[];const t=5+2*this.wave,e=1+.15*this.wave,s=1+Math.max(0,.1*(this.wave-15));let i=["ghost"];if(this.wave>2&&i.push("skull"),this.wave>5&&i.push("zombie"),this.wave>8&&i.push("ranger"),this.wave>12&&i.push("tank"),this.wave%5==0){this.spawnQueue.push({type:"boss",mult:.8*e,dmgMult:s});for(let t=0;t<3;t++)this.spawnQueue.push({type:"tank",mult:1,dmgMult:s})}else for(let l=0;l<t;l++){const t=i[Math.floor(Math.random()*i.length)];this.spawnQueue.push({type:t,mult:e,dmgMult:s})}if(this.wave>=21){const t=Math.floor(Math.pow(1.5,this.wave-20));this.toast(`‚ö†Ô∏è ÊÅ∂È≠îÂÖ•‰æµ x${t}`);for(let e=0;e<t;e++)this.spawnQueue.push({type:"demon",mult:1+.1*(this.wave-20),dmgMult:s})}this.updateUI()},logic(){if(this.spawnQueue.length>0&&Math.random()<.03){const t=this.spawnQueue.shift();this.spawnEnemy(t.type,t.mult,t.dmgMult)}this.active&&0===this.enemies.length&&0===this.spawnQueue.length&&(this.active=!1,this.timer=90),!this.active&&this.timer>0&&(this.timer--,this.timer<=0&&this.nextWave()),this.updateEnemies(),this.updateTurrets(),this.updateBullets(),this.updateParticles(),this.hp<=0&&(this.run=!1,document.getElementById("final-score").innerText=this.wave,document.getElementById("screen-over").style.display="flex")},spawnEnemy(t,e,s){const i=E_DEFS[t],l=Math.floor(Math.random()*CFG.COLS),h=this.ox+(l+.5)*this.cell,o=this.oy-this.cell;this.enemies.push({x:h,y:o,def:i,hp:i.hp*e,maxHp:i.hp*e,spd:i.spd,dmg:i.dmg*(s||1),val:i.val,state:"move",target:null,timer:0,stunTimer:0,slowTimer:0})},updateEnemies(){const t=this.oy+CFG.ROWS*this.cell;for(let e=this.enemies.length-1;e>=0;e--){const s=this.enemies[e];if(s.hp<=0)this.gold+=s.val,this.spawnParts(s.x,s.y,s.def.color,10),this.enemies.splice(e,1),this.updateUI();else if(s.stunTimer>0)s.stunTimer--;else if(s.def.isBoss)this.updateBoss(s);else if(s.def.range>0){if(!s.target||s.target.hp<=0){let t=s.def.range;this.turrets.forEach(e=>{const i=Math.hypot(e.x-s.x,e.y-s.y);i<t&&(t=i,s.target=e)})}if(s.target){Math.hypot(s.target.x-s.x,s.target.y-s.y)<s.def.range?(s.timer++,s.timer>60&&(this.bullets.push({x:s.x,y:s.y,tgt:s.target,spd:5,dmg:s.dmg,color:"#ff8800",enemy:!0}),s.timer=0)):s.y+=s.spd}else s.y+=s.spd;s.y>t&&(this.hp--,s.hp=0,this.updateUI())}else if("move"===s.state){let e=s.y+s.spd;s.slowTimer>0&&(e*=.5,s.slowTimer--);let i=!1;for(let t of this.turrets)if(Math.abs(s.x-t.x)<.8*this.cell&&Math.abs(e-t.y)<.8*this.cell){i=!0,s.target=t,s.state="atk";break}i||(s.y=e,s.y>t&&(this.hp--,s.hp=0,this.updateUI()))}else"atk"===s.state&&(!s.target||s.target.hp<=0?(s.state="move",s.target=null):(s.timer++,s.timer>40&&(s.target.hp-=s.dmg,this.spawnParts(s.target.x,s.target.y,"#f00",3),s.timer=0)))}},updateBoss(t){if(t.timer++,t.y<this.oy+2*this.cell&&(t.y+=.2),t.timer%30==0)for(let e=0;e<8;e++){const s=2*Math.PI/8*e+.05*t.timer;this.bullets.push({x:t.x,y:t.y,vx:3*Math.cos(s),vy:3*Math.sin(s),dmg:30,color:"#f0f",enemy:!0})}t.timer%300==0&&this.spawnQueue.push({type:"tank",mult:1,dmgMult:1})},updateTurrets(){for(let t=this.turrets.length-1;t>=0;t--){const e=this.turrets[t];if(e.hp<=0){this.grid[e.r][e.c]=0,this.spawnParts(e.x,e.y,"#555",10),this.turrets.splice(t,1);continue}if(e.def.isSupport){if(e.cd>0){e.cd--;continue}let t=!1;this.turrets.forEach(s=>{if(s===e||s.hp<=0)return;Math.hypot(s.x-e.x,s.y-e.y)<e.range&&s.hp<s.maxHp&&(s.hp+=s.maxHp*e.heal,s.hp>s.maxHp&&(s.hp=s.maxHp),t=!0)}),t&&(e.cd=e.def.cd);continue}if(e.def.isLaser){e.targets=[],this.enemies.forEach(t=>{Math.hypot(t.x-e.x,t.y-e.y)<e.range&&(t.hp-=e.dmg,e.targets.push(t))});continue}if(0===e.def.dmg)continue;if(e.cd>0){e.cd--;continue}let s=null,i=e.def.range;this.enemies.forEach(t=>{const l=Math.hypot(t.x-e.x,t.y-e.y);l<i&&(i=l,s=t)}),s&&(this.bullets.push({x:e.x,y:e.y,tgt:s,spd:8,dmg:e.dmg,color:e.def.color,effect:e.def.effect,effectVal:e.effectVal||0}),e.cd=e.def.cd)}},updateBullets(){for(let t=this.bullets.length-1;t>=0;t--){const e=this.bullets[t];if(e.enemy){if(e.tgt){if(e.tgt.hp<=0){this.bullets.splice(t,1);continue}const s=e.tgt.x-e.x,i=e.tgt.y-e.y,l=Math.hypot(s,i);l<10?(e.tgt.hp-=e.dmg,this.spawnParts(e.x,e.y,"#f00",3),this.bullets.splice(t,1)):(e.x+=s/l*e.spd,e.y+=i/l*e.spd)}else{if(e.x+=e.vx,e.y+=e.vy,e.y>this.height){this.bullets.splice(t,1);continue}for(let s of this.turrets)if(Math.hypot(s.x-e.x,s.y-e.y)<this.cell/2){s.hp-=e.dmg,this.bullets.splice(t,1);break}}continue}if(!e.tgt||e.tgt.hp<=0){this.bullets.splice(t,1);continue}const s=e.tgt.x-e.x,i=e.tgt.y-e.y,l=Math.hypot(s,i);l<10?(e.tgt.hp-=e.dmg,"slow"===e.effect&&(e.tgt.slowTimer=e.effectVal),"stun"===e.effect&&(e.tgt.stunTimer=e.effectVal),this.spawnParts(e.x,e.y,e.color,3),this.bullets.splice(t,1)):(e.x+=s/l*e.spd,e.y+=i/l*e.spd)}},updateParticles(){for(let t=this.parts.length-1;t>=0;t--){const e=this.parts[t];e.x+=e.vx,e.y+=e.vy,e.life--,e.life<=0&&this.parts.splice(t,1)}},spawnParts(t,e,s,i){for(let l=0;l<i;l++)this.parts.push({x:t,y:e,color:s,vx:4*(Math.random()-.5),vy:4*(Math.random()-.5),life:20})},touch(t,e){if(!this.run||this.paused)return;const s=this.cvs.getBoundingClientRect(),i=t-s.left,l=e-s.top,h=Math.floor((i-this.ox)/this.cell),o=Math.floor((l-this.oy)/this.cell);if(h<0||h>=CFG.COLS||o<0||o>=CFG.ROWS)return;const a=this.turrets.find(t=>t.c===h&&t.r===o);if(a)this.showMenu(a,t,e);else if(this.closeMenu(),this.selected){const t=T_DEFS.find(t=>t.id===this.selected);this.gold>=t.cost&&(t.isBomb?this.placeBomb(o,h,t):0===this.grid[o][h]&&this.placeTurret(o,h,t))}},placeBomb(t,e,s){this.gold-=s.cost;const i=this.ox+(e+.5)*this.cell,l=this.oy+(t+.5)*this.cell;this.spawnParts(i,l,"#ff8800",30),this.spawnParts(i,l,"#ffff00",20),this.enemies.forEach(t=>{Math.hypot(t.x-i,t.y-l)<s.range&&(t.hp-=s.dmg,this.spawnParts(t.x,t.y,"#fff",5))}),this.selected=null,this.updateUI()},placeTurret(t,e,s){this.gold-=s.cost,this.grid[t][e]=1;const i=this.ox+(e+.5)*this.cell,l=this.oy+(t+.5)*this.cell,h={r:t,c:e,x:i,y:l,def:s,hp:s.hp,maxHp:s.hp,dmg:s.dmg,cd:0,lvl:1,range:s.range,heal:s.heal||0,effectVal:s.effectVal||0,targets:[],triggered:!1,timer:0};this.turrets.push(h),this.spawnParts(i,l,"#fff",5),this.selected=null,this.updateUI()},showMenu(t,e,s){this.target=t;const i=Math.floor(t.def.cost*(1+.5*t.lvl)),l=Math.floor(.6*t.def.cost*t.lvl);let h=`Lv.${t.lvl} | HP: ${Math.ceil(t.hp)}`;t.def.dmg>0&&(h+=` | DMG: ${Math.floor(t.dmg)}`),t.def.isSupport&&(h+=` | Heal: ${Math.floor(100*t.heal)}%`),t.def.isLaser&&(h+=` | DPS: ${Math.floor(60*t.dmg)}`),document.getElementById("ctx-title").innerText=`${t.def.emoji} ${t.def.name}`,document.getElementById("ctx-info").innerText=h,document.getElementById("ctx-cost").innerText=i,document.getElementById("ctx-sell").innerText=l,document.getElementById("ctxMenu").style.display="flex"},closeMenu(){document.getElementById("ctxMenu").style.display="none",this.target=null},upgrade(){if(!this.target)return;const t=this.target,e=Math.floor(t.def.cost*(1+.5*t.lvl));if(this.gold>=e){this.gold-=e,t.lvl++,t.hp=t.maxHp+=.2*t.def.hp;const s=t.def.upg;s&&(s.dmg&&(t.dmg+=s.dmg),s.cd&&(t.def.cd=Math.max(1,t.def.cd+s.cd)),s.range&&(t.range+=s.range),s.hp&&(t.maxHp+=s.hp),s.heal&&(t.heal+=s.heal),s.effectVal&&(t.effectVal+=s.effectVal)),this.updateUI(),this.spawnParts(t.x,t.y,"#ffd700",5)}this.closeMenu()},sell(){if(!this.target)return;const t=this.target,e=Math.floor(.6*t.def.cost*t.lvl);this.gold+=e,this.grid[t.r][t.c]=0,this.turrets=this.turrets.filter(e=>e!==t),this.updateUI(),this.closeMenu()},updateUI(){document.getElementById("s-gold").innerText=this.gold,document.getElementById("s-hp").innerText=this.hp,document.getElementById("s-wave").innerText=this.wave,this.updateShop()},toast(t){const e=document.getElementById("toast");e.innerText=t,e.style.opacity=1,setTimeout(()=>e.style.opacity=0,1500)},loop(){this.run&&!this.paused&&this.logic(),this.draw(),requestAnimationFrame(()=>this.loop())},draw(){const t=this.ctx,e=this.width,s=this.height,i=this.dpr;t.save(),t.setTransform(i,0,0,i,0,0),t.clearRect(0,0,e,s),t.strokeStyle="rgba(0, 242, 255, 0.1)",t.lineWidth=1;for(let e=0;e<=CFG.COLS;e++){const s=Math.floor(this.ox+e*this.cell);t.beginPath(),t.moveTo(s,this.oy),t.lineTo(s,this.oy+CFG.ROWS*this.cell),t.stroke()}for(let e=0;e<=CFG.ROWS;e++){const s=Math.floor(this.oy+e*this.cell);t.beginPath(),t.moveTo(this.ox,s),t.lineTo(this.ox+CFG.COLS*this.cell,s),t.stroke()}t.fillStyle="rgba(0, 255, 136, 0.1)",t.fillRect(this.ox,this.oy+CFG.ROWS*this.cell,CFG.COLS*this.cell,this.cell),t.fillStyle="#0f8",t.font="12px Orbitron",t.textAlign="center",t.fillText("BASE",e/2,this.oy+CFG.ROWS*this.cell+this.cell/2),this.turrets.forEach(e=>{if(e.def.isLaser&&e.targets.length>0&&(t.strokeStyle=e.def.color,t.lineWidth=2,t.shadowBlur=10,t.shadowColor=e.def.color,e.targets.forEach(s=>{t.beginPath(),t.moveTo(Math.floor(e.x),Math.floor(e.y)),t.lineTo(Math.floor(s.x),Math.floor(s.y)),t.stroke()}),t.shadowBlur=0),e.def.isSupport&&e.cd>0&&(t.strokeStyle="rgba(0, 255, 136, 0.3)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),e.range,0,2*Math.PI),t.stroke()),t.fillStyle=e.def.color,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.4*this.cell,0,2*Math.PI),t.fill(),t.fillStyle="rgba(0,0,0,0.5)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.35*this.cell,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.font=`${Math.floor(.4*this.cell)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.def.emoji,Math.floor(e.x),Math.floor(e.y)),e.hp<e.maxHp){const s=Math.floor(e.x-15),i=Math.floor(e.y-25);t.fillStyle="#000",t.fillRect(s,i,30,4),t.fillStyle="#0f0",t.fillRect(s,i,e.hp/e.maxHp*30,4)}}),this.enemies.forEach(e=>{e.stunTimer>0?(t.fillStyle="rgba(255,255,0,0.3)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.6*this.cell,0,2*Math.PI),t.fill()):e.slowTimer>0&&(t.fillStyle="rgba(0,255,255,0.3)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.6*this.cell,0,2*Math.PI),t.fill()),t.fillStyle=e.def.color,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.3*this.cell,0,2*Math.PI),t.fill(),t.fillStyle="rgba(0,0,0,0.5)",t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),.25*this.cell,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.font=`${e.def.isBoss?40:Math.floor(.5*this.cell)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(e.def.emoji,Math.floor(e.x),Math.floor(e.y));t.fillStyle="#000",t.fillRect(Math.floor(e.x-15),Math.floor(e.y-20),30,3),t.fillStyle="#f00",t.fillRect(Math.floor(e.x-15),Math.floor(e.y-20),e.hp/e.maxHp*30,3)}),this.bullets.forEach(e=>{t.fillStyle=e.color,t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),3,0,2*Math.PI),t.fill()}),this.parts.forEach(e=>{t.globalAlpha=e.life/20,t.fillStyle=e.color,t.fillRect(Math.floor(e.x),Math.floor(e.y),2,2)}),t.globalAlpha=1,t.restore()}};Game.init()</script></body></html>
